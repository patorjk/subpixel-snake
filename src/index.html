<!DOCTYPE html>
<html lang="en">
<head>
  <!--
  http://patorjk.com/games/subpixel-snake

  Source code is available here: https://github.com/patorjk/subpixel-snake

  -->
  <meta charset="utf-8">
  <title>JavaScript Snake</title>
  <link rel=stylesheet id="style" type="text/css" href="./css/main-snake.css?version=3" />
  <link rel="shortcut icon" href="css/images/favicon.png" />
</head>
<body>

  <div style="display:flex;flex-direction:column;align-items:center;justify-content:center">
    <h1>Subpixel Snake</h1>
    <h3 style="margin-top:0;">You may need a microscope</h3>
    <div style="width: 32px; height: 32px;">
      <svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-1wmkh38" focusable="false" aria-hidden="true" viewBox="0 0 24 24"><path d="m20 12-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8z"></path></svg>
    </div>
    <div id="game-area" tabindex="0" style="width:500px;height:1500px;"></div>
    <div id="message" style="margin-top:1rem;display:flex;gap:2rem;">
    </div>
    <div style="margin-top:1rem;display:flex;flex-direction:column;gap:2rem;">
      <div style="margin-top:1rem;display:flex;flex-direction:row;gap:2rem;justify-content: center;">
        <div style="display:flex;flex-direction:row;">Length: <div id="snakeLength">1</div></div>
        <div style="display:flex;flex-direction:row;">High score: <div id="highScore">1</div></div>
      </div>
      <div id="speed-section" style="display:flex;justify-content: center;gap:0.5rem;"><label for="speed">Time between snake moves in milliseconds:</label> <input id="speed" type="number" min="50"/></div>
      <div id="options-section" style="display:none;justify-content: center;"><input type="checkbox" id="useButtons"/><label for="useButtons">Use buttons for arrow keys</label></div>

      <div id="buttons" style="display:none;">
        <div style="display:flex;justify-content:center;gap:4rem;margin-top:10rem;">
          <button id="leftArrow" class="arrow-button">←</button>
          <button id="rightArrow" class="arrow-button">→</button>
          <button id="upArrow" class="arrow-button">↑</button>
          <button id="downArrow" class="arrow-button">↓</button>
        </div>
      </div>

      <div id="dpr" style="display:flex;flex-direction:row;gap:0.25rem;justify-content:center;">Device pixel ratio: <div id="pixelRatio"></div><div id="ratioMessage" style="display:none;font-weight:bold;">(The ratio needs to be 1 for this to work, please zoom in or out)</div></div>

      <div style="display:flex;flex-direction:row;gap:0.25rem;align-self:center;">
        <a href="https://patorjk.com/">patorjk.com</a>
      </div>
    </div>
  </div>

  <script type="text/javascript" src="./js/snake.js?version=a5"></script>
  <script type="text/javascript" src="./js/init.js?version=a5"></script>

  <script>
    const updateRatio = () => {
      let ratio = window.devicePixelRatio;
      document.getElementById('pixelRatio').innerHTML = ratio;

      if (ratio !== 1) {
        document.getElementById('ratioMessage').style.display = 'block';
      } else {
        document.getElementById('ratioMessage').style.display = 'none';
      }
    }
    updateRatio();
    window.addEventListener('resize', updateRatio);

    document.getElementById('dpr').addEventListener('click', updateRatio);

    // the user may try to use the arrow keys without the game focused, so if they do, focus the game board
    window.addEventListener('keyup', (evt) => {
      const theKeys = {
        "ArrowLeft"  : true,
        "ArrowRight" : true,
        "ArrowUp"    : true,
        "ArrowDown"  : true,
      }
      if (theKeys[evt.key]) {
        document.getElementById('game-area').focus();
      }

      if (evt.key === '0') {
        if (document.getElementById('playAgain')) {
          document.getElementById('playAgain').click();
        }
      }
    });

    document.getElementById('useButtons').addEventListener('change', (evt) => {
      if (evt.currentTarget.checked) {
        document.getElementById('buttons').style.display = 'block';
      } else {
        document.getElementById('buttons').style.display = 'none';
      }
    });

    document.getElementById('rightArrow').addEventListener('click', () => {
      const evt = new CustomEvent("keybuttonpress", {detail: {key:"ArrowRight", keyCode: 39, buttonPress: true}});
      document.getElementById('game-area').focus();
      document.getElementById('game-area').dispatchEvent(evt);
    });

    document.getElementById('leftArrow').addEventListener('click', () => {
      const evt = new CustomEvent("keybuttonpress", {detail: {key:"ArrowLeft", keyCode: 37, buttonPress: true}});
      document.getElementById('game-area').focus();
      document.getElementById('game-area').dispatchEvent(evt);
    });

    document.getElementById('upArrow').addEventListener('click', () => {
      const evt = new CustomEvent("keybuttonpress", {detail: {key:"ArrowUp", keyCode: 38, buttonPress: true}});
      document.getElementById('game-area').focus();
      document.getElementById('game-area').dispatchEvent(evt);
    });

    document.getElementById('downArrow').addEventListener('click', () => {
      const evt = new CustomEvent("keybuttonpress", {detail: {key:"ArrowDown", keyCode: 40, buttonPress: true}});
      document.getElementById('game-area').focus();
      document.getElementById('game-area').dispatchEvent(evt);
    });

  </script>

</body>
</html>
